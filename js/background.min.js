window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;var tv={indexedDB:{}},DB="tv_man",DB_show="tv_shows",DB_epi="tv_episodes",DB_img="tv_images";tv.indexedDB.db=null;
tv.indexedDB.open=function(){var c=indexedDB.open(DB,2);c.onupgradeneeded=function(a){var b=a.target.result;a.target.transaction.onerror=function(){console.log("Transaction error.")};b.objectStoreNames.contains(DB)&&b.deleteObjectStore(DB);a=b.createObjectStore(DB_show,{keyPath:"showid"});a.createIndex("name","name",{unique:!1});a.createIndex("day","day",{unique:!1});a.createIndex("deleted","deleted",{unique:!1});a=b.createObjectStore(DB_epi,{keyPath:"episodeID"});a.createIndex("showid","showid",
{unique:!1});a.createIndex("airdate","airdate",{unique:!1});a.createIndex("season","season",{unique:!1});a.createIndex("episode","episode",{unique:!1});b.createObjectStore(DB_img,{keyPath:"showid"})};c.onsuccess=function(a){tv.indexedDB.db=a.target.result;tv.indexedDB.getTodayCount()};c.onerror=function(){console.log("Error opening db.")}};
tv.indexedDB.getTodayCount=function(){var c=tv.indexedDB.db.transaction([DB_epi],"readwrite").objectStore(DB_epi),a="",b=new Date,a=b.getDate(),d=b.getMonth()+1,b=b.getFullYear();10>a&&(a="0"+a);10>d&&(d="0"+d);a=b+"-"+d+"-"+a;console.log(a);c=c.index("airdate");a=IDBKeyRange.only(a);c.count(a).onsuccess=function(a){a=a.target.result;chrome.browserAction.setBadgeText({text:a.toString()});console.log(a)}};tv.indexedDB.open();